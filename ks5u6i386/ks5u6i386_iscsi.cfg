#platform=x86, AMD64, or Intel EM64T
# System authorization information
auth  --useshadow  --enablemd5
# System bootloader configuration
bootloader --location=mbr --driveorder=sda --append="rhgb quiet"
# Partition clearing information
clearpart --linux --drives=sda

# Use graphical install
text
# Firewall configuration
firewall --disabled
# Run the Setup Agent on first boot
firstboot --disable
# System keyboard
keyboard us
# System language
lang en_US.UTF-8
# Installation logging level
logging --level=info
# Use CDROM installation media
cdrom
# Network information
network --bootproto=static --device=eth0  --gateway=192.168.182.1 --ip=192.168.182.4 --netmask=255.255.255.0 --onboot=on --hostname=sana.sitea.example.com --noipv6 --nameserver=127.0.0.1
#Root password
rootpw --iscrypted $1$aG1YBRQn$xM1cwBp8N1SEmsM1Ao2Is.

# SELinux configuration
selinux --disabled
# System timezone
timezone  America/Los_Angeles
# Install OS instead of upgrade
install
# X Window System configuration information
xconfig  --startxonboot

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
part /boot --fstype ext3 --size=100 --ondisk=sda
part swap --size=1024 --ondisk=sda
part / --fstype ext3 --size=38000 --ondisk=sda

# service
services --disabled=bluetooth,iptables,ip6tables,sendmail,cups,smartd,dund,yum-updatesd,ntpd
#
poweroff

# All packages needed by Oracle installation include Gnome desktop
# NOTE: despite explicitly removing a pkg, dependencies may add them later on.
# Always clean up RPMs/packages after reboot and before an up2date/yum update
#OEL5: up2date deprecated! use yum
%packages
@admin-tools
@base
@core
#@dialup
@editors
@gnome-desktop
#@games
@graphical-internet
#@graphics
@java
@legacy-software-support
#@office
#@printing
#@sound-and-video
@system-tools
@text-internet
@base-x
system-config-kickstart
kexec-tools
fipscheck
squashfs-tools
device-mapper-multipath
sgpio
emacs
libsane-hpaio
compat-db
festival
e4fsprogs
createrepo
audit
sysstat
xorg-x11-utils
xorg-x11-server-Xnest
readline-devel
gdb
libtermcap-devel
scsi-target-utils*
bind
#
%post --log=/root/ks-post.log
wget http://192.168.182.120/rlwrap-0.37.tar.gz -O /var/local/rlwrap.tar.gz
wget http://192.168.182.120/VMwareTools-8.4.5-332101.tar.gz -O /var/local/VMwareTools.tar.gz
tar zxf /var/local/rlwrap.tar.gz -C /var/local
tar zxf /var/local/VMwareToos.tar.gz -C /var/local
#
#  SAN network (iscsi) 1.99.1.xxx
#
cat > /etc/sysconfig/network-scripts/ifcfg-eth1 << EOF
DEVICE=eth1
BOOTPROTO=static
ONBOOT=on
IPADDR=1.99.1.4
NETMASK=255.255.255.0
EOF
#
#  DNS RAC network  192.168.31.xxx
#
cat > /etc/sysconfig/network-scripts/ifcfg-eth2 << EOF
DEVICE=eth2
BOOTPROTO=static
ONBOOT=on
IPADDR=192.168.31.4
NETMASK=255.255.255.0
EOF
#
#
#
cat >> /etc/tgt/targets.conf << EOF
<target iqn.com.example.mngta.volumes-sana:tgtd>
   # List of files to export as LUNs
   backing-store /disks/disk01.dat
   backing-store /disks/disk02.dat
   backing-store /disks/disk03.dat
   backing-store /disks/disk04.dat
   backing-store /disks/disk05.dat
   backing-store /disks/disk06.dat
   backing-store /disks/disk07.dat
   backing-store /disks/disk08.dat
   backing-store /disks/disk09.dat
   backing-store /disks/disk10.dat
   backing-store /disks/disk11.dat
   backing-store /disks/disk12.dat
   backing-store /disks/disk21.dat
   backing-store /disks/disk22.dat
   backing-store /disks/disk23.dat
</target>
EOF
#
#
#
cat > /etc/named.conf << EOF
options {
version "unknown";
directory "/var/named";
dump-file "/var/log/named_dump.db";
statistics-file "/var/log/named.stats";
memstatistics-file "/var/log/named_mem.sats";
listen-on-v6 {none;};
notify no;

};

logging {
channel query_logging {
file "/var/named/named_querylog"
versions 3 size 100M;
};
category queries {
query_logging;
};

# Or log this kind alternatively to syslog.
channel syslog_queries {
syslog user;
severity info;
};
category queries { syslog_queries; };

# Log general name server errors to syslog.
channel syslog_errors {
syslog user;
severity error;
};
category default { syslog_errors; };

# Don't log lame server messages.
category lame-servers { null; };
};

acl acl_transf { 192.168.31.4; };

#zone "." in {
# type hint;
# file "root.hint";
#};

zone "localhost" in {
type master;
file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
type master;
file "127.0.0.zone";
};

zone "sitea.example.com" in {
type master;
file "db.sitea.example.com";
allow-transfer { acl_transf; };
};
EOF
#
#
#
cat > /var/named/127.0.0.zone << EOF
\$TTL 1D
@ IN SOA localhost. root.localhost. (
20110418 ; serial (d. adams)
3H ; refresh
15M ; retry
1W ; expiry
1D ) ; minimum
  IN NS  localhost.
1 IN PTR localhost.
EOF
#
#
#
cat > /var/named/localhost.zone << EOF
\$TTL 1D
@ IN SOA  localhost. root.localhost. (
2011418 ; serial (d. adams)
3H ; refresh
15M ; retry
1W ; expiry
1D ) ; minimum
 IN NS localhost.
 IN A 127.0.0.1
EOF
#
#
#
cat > /var/named/db.sitea.example.com  << EOF
\$TTL 3600
@ IN SOA sana-dns.sitea.example.com. sana-dns.sitea.example.com. (
20110418; serial
3600 ; refresh (15 minutes)
900 ; retry (10 minutes)
3600000 ; expire (1 day)
3600 ; minimum (1 hour)
)
 IN NS sana-dns.sitea.example.com.
nodea1      A 192.168.31.5
nodea1-vip  A 192.168.31.50
nodea1-priv A 192.168.41.5
nodea1-san  A 1.99.1.5
nodea2      A 192.168.31.6
nodea2-vip  A 192.168.31.60
nodea2-priv A 192.168.41.6
nodea2-san  A 1.99.1.6
scan        A 192.168.31.20
scan        A 192.168.31.21
scan        A 192.168.31.22
sana-dns    A 192.168.31.4
sana        A 1.99.1.4
EOF
#
#
#
touch /var/named/named_querylog
#
#
#
chown -R named:named /var/named/
chown named:named /etc/named.conf
#
#
#
cat >> /etc/hosts << EOF 
# Primary Site #=============================================
# Node 1
192.168.31.5  nodea1.sitea.example.com      nodea1
192.168.31.50 nodea1-vip.sitea.example.com  nodea1-vip
192.168.41.5  nodea1-priv.sitea.example.com nodea1-priv
192.168.182.5 nodea1-san.sitea.example.com  nodea1-san
# Node 2
192.168.31.6  nodea2.sitea.example.com      nodea2
192.168.31.60 nodea2-vip.sitea.example.com  nodea2-vip
192.168.41.6  nodea2-priv.sitea.example.com nodea2-priv
192.168.182.6 nodea2-san.sitea.example.com  nodea2-san
# SAN
192.168.41.4  sana.sitea.example.com        sana
# DNS
192.168.31.4  sana-dns.sitea.example.com    sana-dns
#=============================================
EOF
#
#
#
mkdir /disks
for i in 1 2 3 4 5 6 7 8 9
do
dd if=/dev/zero of=/disks/disk0$i.dat bs=1M count=2048
done
#
for i in 10 11 12
do
dd if=/dev/zero of=/disks/disk$i.dat bs=1M count=2048
done
#
for i in 21 22 23
do
dd if=/dev/zero of=/disks/disk$i.dat bs=1M count=680
done